[gd_scene load_steps=2 format=3 uid="uid://51v3rjhohssr"]

[sub_resource type="GDScript" id="GDScript_1jw8b"]
resource_name = "LoadReplayMenu"
script/source = "extends CanvasLayer

const LoadReplayButton := preload(\"res://load_replay_button.tscn\")

signal replay_toggled(replay_uri: String, toggled: bool)

var track_uri: String
var selected_replay_uris: Array[String]


func _enter_tree() -> void:
	if track_uri.is_empty():
		return

	for replay_uri in Replays.loaded_replays:
		var replay: TrackReplay = Replays.loaded_replays[replay_uri]
		if replay.track_name != track_uri:
			continue

		var button := LoadReplayButton.instantiate()
		button.set_replay_name(replay_uri.get_file().get_basename())
		button.set_player_name(replay.player_name)
		# count - 180 is for the countdown which is not counted for total replay time
		button.set_replay_time(Replays.human_time(replay.replay.get_count() - 180, true))
		button.button_pressed = selected_replay_uris.find(replay_uri) != -1
		button.toggled.connect(func(toggled: bool): replay_toggled.emit(replay_uri, toggled))
		%ReplayButtonContainer.add_child(button)
"

[node name="CanvasLayer" type="CanvasLayer"]
script = SubResource("GDScript_1jw8b")

[node name="PanelContainer" type="PanelContainer" parent="."]
auto_translate_mode = 1
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
offset_left = 409.0
offset_top = 169.0
offset_right = -409.0
offset_bottom = -169.0
grow_horizontal = 2
grow_vertical = 2

[node name="MarginContainer" type="MarginContainer" parent="PanelContainer"]
auto_translate_mode = 1
layout_mode = 2
theme_override_constants/margin_left = 15
theme_override_constants/margin_top = 15
theme_override_constants/margin_right = 15
theme_override_constants/margin_bottom = 15

[node name="VBoxContainer" type="VBoxContainer" parent="PanelContainer/MarginContainer"]
auto_translate_mode = 1
layout_mode = 2
theme_override_constants/separation = 15

[node name="Label" type="Label" parent="PanelContainer/MarginContainer/VBoxContainer"]
auto_translate_mode = 1
layout_mode = 2
text = "Load Replay"
horizontal_alignment = 1

[node name="ScrollContainer" type="ScrollContainer" parent="PanelContainer/MarginContainer/VBoxContainer"]
layout_mode = 2
size_flags_vertical = 3
follow_focus = true
horizontal_scroll_mode = 0

[node name="MarginContainer" type="MarginContainer" parent="PanelContainer/MarginContainer/VBoxContainer/ScrollContainer"]
layout_mode = 2
size_flags_horizontal = 3
theme_override_constants/margin_left = 5
theme_override_constants/margin_top = 5
theme_override_constants/margin_right = 5
theme_override_constants/margin_bottom = 5

[node name="ReplayButtonContainer" type="VBoxContainer" parent="PanelContainer/MarginContainer/VBoxContainer/ScrollContainer/MarginContainer"]
unique_name_in_owner = true
auto_translate_mode = 1
layout_mode = 2
size_flags_horizontal = 3
theme_override_constants/separation = 5
